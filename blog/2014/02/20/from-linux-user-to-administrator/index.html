<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta content="Shawn" property="og:site_name">
  <link href="/favicon.png" rel="icon">

  
  <meta content="From Linux User to Administrator" property="og:title">
  

  
  <meta content="article" property="og:type">
  

  
  <meta content="<h1>Children of The Sun</h1> " property="og:description">
  

  
  <meta content="http://shawnLeeZX.github.io/blog/2014/02/20/from-linux-user-to-administrator/" property="og:url">
  

  
  <meta content="2014-02-20T00:04:00+08:00" property="article:published_time">
  <meta content="http://shawnLeeZX.github.io/about/" property="article:author">
  

  <meta property="og:image" content="">

  
  
  <meta content="Linux" property="article:section">
  
  

  
  
  

  <title>From Linux User to Administrator - Shawn</title>
  <meta name="description" content="Recently, I received a job to do sysadmin stuff on some servers, which haveubuntu installed on them. Here I wrote down what I have done for setting upthose s...">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css" integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.slim.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="/css/main.css">

  <!-- Typesetting math using MathJax -->
  <!-- mathjax config similar to math.stackexchange -->
  <script type="text/x-mathjax-config">
   MathJax.Hub.Config({
     jax: ["input/TeX", "output/HTML-CSS"],
     tex2jax: {
       inlineMath: [ ['$', '$'] ],
       displayMath: [ ['$$', '$$']],
       processEscapes: true,
       skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
     },
     messageStyle: "none",
     "HTML-CSS": { preferredFont: "TeX", availableFonts: ["STIX","TeX"] }
   });
  </script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-44220731-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>

  <link href="/css/fonts/orbitron.css" rel="stylesheet" type="text/css">
  <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
  <link rel="canonical" href="http://shawnLeeZX.github.io/blog/2014/02/20/from-linux-user-to-administrator/">
  <link rel="alternate" type="application/rss+xml" title="Shawn" href="http://shawnLeeZX.github.io/feed.xml">
</head>

  <body>
    <section>
  <nav class="navbar navbar-default navbar-expand-lg fixed-top">
    <div class="container">

      <!-- Brand and toggle get grouped for better mobile display -->
      <a class="navbar-brand" href="/">Shawn</a>
      <button type="button" class="navbar-toggle btn" data-toggle="collapse" data-target="#navBar" aria-expanded="false">
        <i class="fa fa-bars"></i>
      </button>

      <div class="collapse navbar-collapse" id="navBar">
        <ul class="navbar-nav ml-auto">
          <li class="nav-item"><a class="nav-link" href="/theory">NN Theory</a></li>
          <li class="nav-item"><a class="nav-link" href="/engineering">Engineering</a></li>
          <li class="nav-item"><a class="nav-link" href="/talks">Talks</a></li>
          <li class="nav-item"><a class="nav-link" href="/misc">Misc Research</a></li>
          <!-- <li class="nav-item"><a class="nav-link" href="/philosophy">Philosophy</a></li> -->
          <li class="nav-item"><a class="nav-link" href="/blog">Notes</a></li>
        </ul>
      </div><!-- /.navbar-collapse -->

    </div>
  </nav>
</section>

    <section>
      <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <div class="jumbotron">
    <div class="container">
      <h1 class="page-title" itemprop="name headline">From Linux User to Administrator</h1>
      <p class="post-meta"><time datetime="2014-02-20T00:04:00+08:00" itemprop="datePublished">Feb 20, 2014</time></p>
    </div>

</div>


  <div class="content post-content container" itemprop="articleBody">
    <p>Recently, I received a job to do sysadmin stuff on some servers, which have
ubuntu installed on them. Here I wrote down what I have done for setting up
those servers.</p>

<!-- more -->

<p>The book, <em>UNIX and Linux System Administration Handbook 4th edition</em> is the
bible for sysadmins. You can find everything you need, at least for some hints
from this book.</p>

<p>Besides the linux administration thing, you should understand ssh thing – how
it works, what tools are available, and how it is related to ansible.</p>

<p>This book, <em>SSH Mastery OpenSSH, PuTTY, Tunnels and Keys</em> has done a great job.</p>

<p>Besides the techniques learnt from the two books, I will write down some
details of what I have done in the following sections.</p>

<p>Note that this post does not teach you how to become a sysadmin – this is a
job of a whole book, like the one has been mentioned. There are just a subset
of the necessary jobs should be done by a sysadmin.</p>

<h2 id="set-default-editor">Set Default Editor</h2>

<p>To set up default editor for linux, the following environment variables should
be set.</p>

<p><strong>NOTE</strong>: this method works for any linux distribution. For debian/ubuntu, a
alternative will be the <code class="highlighter-rouge">update-alternatives</code> program. See 
<a href="#cuttingedge">Use cutting-edge development tools in linux section</a>.</p>

<p>Take setting vim as an example.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="c">### Setting for default editor.</span>
<span class="c">### The default editor I use is vim.</span>
<span class="c">### Define the absolute path of vim, thus to make the update of vi easier.</span>
<span class="nb">export </span><span class="nv">VIM</span><span class="o">=</span>/usr/bin
<span class="nb">export </span><span class="nv">VIMRUNTIME</span><span class="o">=</span>/usr/share/vim/vim73

<span class="c">### Two variables concerning default editor of linux.</span>
<span class="nb">export </span><span class="nv">EDITOR</span><span class="o">=</span><span class="nv">$VIM</span>/vim
<span class="nb">export </span><span class="nv">VISUAL</span><span class="o">=</span><span class="nv">$VIM</span>/vim
<span class="c">### The default editor defined for git.</span>
<span class="nb">export </span><span class="nv">GIT_EDITOR</span><span class="o">=</span><span class="nv">$VIM</span>/vim
</code></pre>
</div>

<h2 id="change-color-display-in-the-bash-shell">Change Color Display in the Bash Shell</h2>

<p>It annoys me that the color of directories is too hard to read. To fix this, a
environment variable LS_COLORS should be changed.</p>

<p>There is a really nice post about this: <a href="http://www.geekgumbo.com/2011/11/04/changing-the-directory-color-in-the-bash-shell/">Changing the Directory Color in the Bash Shell</a></p>

<h2 id="monitor-who-is-sshing-in">Monitor who is sshing in.</h2>

<p>Another need is to monitor who is logging on the server using ssh. This can be
done via <code class="highlighter-rouge">ps</code> command.</p>

<p>The most commonly used two ps command is <code class="highlighter-rouge">ps aux</code> and <code class="highlighter-rouge">ps lax</code>. I will not
explain the meaning of those options. See man page or Chapter 5, Section 7 of
the book <em>UINUX and Linux System Administrator Handbook 4th Edition</em>. The
former one is for normal users. The latter one is more technical.</p>

<p>To monitor who are sshing in, use the following command:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>ps aux | egrep <span class="s2">"ssh|STAT"</span>
</code></pre>
</div>

<p>One thing need to be explained is the <code class="highlighter-rouge">STAT</code> in the regex pattern – it will
make egrep leave the title of the ouput table for better viewing.</p>

<p>The output is like(note the color may not be right since it is text copied)</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
root       723  0.0  0.0  50040  2944 ?        Ss   09:56   0:00 /usr/sbin/sshd -D
root      7439  0.0  0.0  90248  3992 ?        Ss   14:43   0:00 sshd: shawn <span class="o">[</span>priv]
shawn     7553  0.0  0.0  90384  1956 ?        S    14:43   0:00 sshd: shawn@pts/0
shawn     8207  0.0  0.0  13592   920 pts/4    S+   15:49   0:00 egrep --color<span class="o">=</span>auto ssh|STAT
</code></pre>
</div>

<p>In the above example, only one user is sshing in.</p>

<p>The first one(PID 723) should be the monitor server for accepting ssh client
calls. sshd(PID 7439) and sshd(7553) should be both used to serve the ssh
client. Every session requires those two. <code class="highlighter-rouge">sshd: shawn [priv]</code> means this is
the privilege separation thread sshd runs for the user logging in. The last one
is egrep I just typed.</p>

<blockquote>
  <p>OpenSSH has built-in protection through privilege separation. Only a small
section of sshd runs with root privileges. Most of the server runs as an
unprivileged user. This means that if an intruder successfully breaks into the
OpenSSH server, he can only do a limited amount of damage to your system. It’s
still really, really annoying, mind you, but not devastating.<br />
– SSH Mastery OpenSSH, PuTTY, Tunnels and Keys</p>
</blockquote>

<h2 id="account-management">Account Management</h2>

<p>This practice works mainly for Ubuntu/Debian system, which have a higher level
utility <code class="highlighter-rouge">adduser</code> command to add users. However, the principles works pretty
the same, I guess.</p>

<p>Be default, <code class="highlighter-rouge">adduser</code> will create a user and a group with the same name for
this user, which means this group will only have one member if no manual change
made. To better capture the structure of your users, the group feature of Linux
should be better utilized.</p>

<p>For example, the simplest devision of users are sysadmins and users. The
following command create two groups:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>adduser --group sysadmin
adduser --group user
</code></pre>
</div>

<p>Then add one user to the <code class="highlighter-rouge">sysadmin</code> group:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>adduser USER_NAME --ingroup sysadmin
</code></pre>
</div>

<p>However, this does not empower the user with the administrator’s power. To
achieve this, you have to add the user to the <code class="highlighter-rouge">sudo</code> group. The method is the
same:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>adduser USER_NAME --ingroup sysadmin
</code></pre>
</div>

<p>To know more about setting sudo users and groups, see this <a href="http://mixeduperic.com/ubuntu/how-to-setup-a-user-or-group-with-sudo-privileges-on-ubuntu.html">post</a>.</p>

<p><a name="cuttingedge"></a></p>

<h2 id="use-cutting-edge-development-tools-in-linux-section">Use cutting-edge development tools in linux section.</h2>

<p>Another job I was asked do is to upgrade softwares to more cutting-edge version.
Take upgrading gcc to newly developed version as an example.</p>

<p>I want to upgrade gcc from version 4.6 to 4.8. As expected, the powerful Ubuntu
supporting community has made a ppa for this. So I won’t bother compiling it
from source.</p>

<p>To use this ppa, type the following commands:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>sudo add-apt-repository ppa:ubuntu-toolchain-r/test
sudo apt-get update
sudo apt-get install g++-4.8
</code></pre>
</div>

<p>However, this is not done yet. To make the 4.8 version gcc/g++ the default gcc
compiler, use the following commands:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-4.8 80 --slave /usr/bin/g++ g++ /usr/bin/g++-4.8
</code></pre>
</div>

<p>See the man page of <code class="highlighter-rouge">update-alternatives</code> to understand its usage.</p>

<p><a name="compilevim"></a></p>

<h2 id="a-note-about-compiling-vim-from-source">A note about compiling vim from source</h2>

<p>I am proud that I am a vimer. The following is the config I need when compiling
vim from source. Consult the vim source doc for the meaning of their config if
needed.</p>

<p><strong>NOTE</strong>:<code class="highlighter-rouge">env LDFLAGS=</code> tells bash where to find shared libs, which will be detailed
later.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="c">#!/bin/bash</span>

env <span class="nv">LDFLAGS</span><span class="o">=</span><span class="s2">"</span><span class="nv">$LDFLAGS</span><span class="s2"> -L/usr/lib/x86_64-linux-gnu/"</span> ./configure --disable-gui <span class="se">\</span>
        --enable-luainterp <span class="se">\</span>
        --enable-perlinterp <span class="se">\</span>
        --enable-pythoninterp <span class="se">\</span>
        --enable-rubyinterp <span class="se">\</span>
        --enable-tclinterp <span class="se">\</span>
        --enable-cscope <span class="se">\</span>
        --enable-multibyte <span class="se">\</span>
        --enable-xim <span class="se">\</span>
        --enable-fontset <span class="se">\</span>
        --with-features<span class="o">=</span>huge <span class="se">\</span>
        --prefix<span class="o">=</span>/home/shawn/mine/softwares/vim
</code></pre>
</div>
<p>However, one thing that may bring trouble is the dependent library needed when
compiling vim.</p>

<p>If you are not bother not knowing what you are installing, you can just install
all the dependence using:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>sudo apt-get install build-dep vim
</code></pre>
</div>
<p>But I want to know what I have installed on my computer and what are they used
for. Thus I perfer installing those dependences one by one by hand.</p>

<p>Here I note down the dependence I have to installe.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="c"># For compiling vim from source.</span>
<span class="c">## Install terminal library.</span>
sudo apt-get install libncurses5-dev
<span class="c">## Install lua library.</span>
sudo apt-get install liblua5.2-dev
sudo apt-get install lua5.2
<span class="c">## Install perl library.</span>
sudo apt-get install libperl-dev
<span class="c">## Install python library.</span>
sudo apt-get install python2.7-dev
<span class="c">## Install ruby library.</span>
sudo apt-get install ruby-dev
<span class="c">## Install tcl library.</span>
sudo apt-get install tcl-dev
</code></pre>
</div>
<p><strong>NOTE</strong>: what library you need to install depends on the packages installed on
your operating system. The one you need to install is highly probably not the
same with me.</p>

<p>There are two things should be pointed out to make sure the successful
compilcation of vim.</p>

<h3 id="tell-bash-where-to-find-the-shared-lib-needed">Tell bash where to find the shared lib needed.</h3>

<p>When you are running <code class="highlighter-rouge">./configure</code>, it will only try to find shared libs in
default folder. For example, at the first time I was compiling vim,
<code class="highlighter-rouge">./configure</code> could not find a terminal library to use – meaning it cannot
find <code class="highlighter-rouge">libncurses.so</code>. By reading the output log, I find it only try to search
shared lib in folder <code class="highlighter-rouge">/usr/lib</code>, however, <code class="highlighter-rouge">libncurses.so</code> resides in
<code class="highlighter-rouge">/usr/lib/x86_64-linux-gnu/</code>, which I guess is because the machine I am
compiling vim on is 64bit. So to let it know where to find those libs, <code class="highlighter-rouge">env LDFLAGS=...</code> is added before <code class="highlighter-rouge">./configure</code>.</p>

<h3 id="make-sure-the-name-of-the-shared-lib-is-right">Make sure the name of the shared lib is right.</h3>

<p>This is not over. When you install a package from package manager software,
like apt in ubuntu, it does not guarantee it is installed as standard name in
standard folder. The mechanism used by linux is a little complicated. See this
<a href="http://www.tldp.org/HOWTO/Program-Library-HOWTO/">post</a> to be better informed if you want.</p>

<p>Here I just illustrate this thing by an example. When I am compiling vim,
<code class="highlighter-rouge">./configure</code> could not find the shared lib of lua. By checking the name of the
shared lib installed of lua, I have its name is <code class="highlighter-rouge">liblua5.2.so</code> in folder
<code class="highlighter-rouge">/usr/lib/x86_64-linux-gnu</code>. To make it can be recognized by <code class="highlighter-rouge">./configure</code>, I
created a symbol link using the following command as a work around:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>ln -s liblua5.2.so liblua.so
</code></pre>
</div>
<h3 id="miscellaneous">Miscellaneous</h3>

<h4 id="clipboard-in-pure-terminal">-clipboard in pure terminal</h4>

<p>Clipboards of vi is handled by X11 on linux. So if you are using vim on
server, it will be compiled without clipboard feature, meaning you cannot not
access system clipboard from vim, and <code class="highlighter-rouge">--version</code> will show <code class="highlighter-rouge">-clipboard</code>.</p>

<p>If you want to compile vim for usage on desktop environment, see this after
this post
<a href="/blog/2014/02/20/setup-linux-from-fresh-installation-using-ansible/#desktopvim">here</a>.</p>

  </div>

</article>

    </section>

    
    <div class="container">
      <section>
        <h1>Comments</h1>
        <div id="disqus_thread" aria-live="polite"><script type="text/javascript">
      var disqus_shortname = 'nautilus-shell-of-hhiker';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://shawnLeeZX.github.io/blog/2014/02/20/from-linux-user-to-administrator/';
        var disqus_url = 'http://shawnLeeZX.github.io/blog/2014/02/20/from-linux-user-to-administrator/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'https://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div>
      </section>
    </div>
    

    <nav class="navbar navbar-default navbar-fixed-bottom">
<div class="container footer-content">
    <!-- Nothing is there. -->
</div>
</nav>
  </body>

</html>
