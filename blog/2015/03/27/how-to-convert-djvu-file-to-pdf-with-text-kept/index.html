<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta content="Shawn" property="og:site_name">
  <link href="/favicon.png" rel="icon">

  
  <meta content="How to Convert Djvu File to PDF with Text Kept" property="og:title">
  

  
  <meta content="article" property="og:type">
  

  
  <meta content="<h1>Children of The Sun</h1> " property="og:description">
  

  
  <meta content="http://shawnLeeZX.github.io/blog/2015/03/27/how-to-convert-djvu-file-to-pdf-with-text-kept/" property="og:url">
  

  
  <meta content="2015-03-27T20:47:00+08:00" property="article:published_time">
  <meta content="http://shawnLeeZX.github.io/about/" property="article:author">
  

  <meta property="og:image" content="">

  
  
  <meta content="Djvu" property="article:section">
  
  

  
  
  

  <title>How to Convert Djvu File to PDF with Text Kept - Shawn</title>
  <meta name="description" content="Finally, I have come up with a solution to convert Djvu format e-book to Pdfformat. This post is going to note down exactly HOW.First, some background about ...">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css" integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.slim.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="/css/main.css">

  <!-- Typesetting math using MathJax -->
  <!-- mathjax config similar to math.stackexchange -->
  <script type="text/x-mathjax-config">
   MathJax.Hub.Config({
     jax: ["input/TeX", "output/HTML-CSS"],
     tex2jax: {
       inlineMath: [ ['$', '$'] ],
       displayMath: [ ['$$', '$$']],
       processEscapes: true,
       skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
     },
     messageStyle: "none",
     "HTML-CSS": { preferredFont: "TeX", availableFonts: ["STIX","TeX"] }
   });
  </script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-44220731-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>

  <link href="/css/fonts/orbitron.css" rel="stylesheet" type="text/css">
  <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
  <link rel="canonical" href="http://shawnLeeZX.github.io/blog/2015/03/27/how-to-convert-djvu-file-to-pdf-with-text-kept/">
  <link rel="alternate" type="application/rss+xml" title="Shawn" href="http://shawnLeeZX.github.io/feed.xml">
</head>

  <body>
    <section>
  <nav class="navbar navbar-default navbar-expand-lg fixed-top">
    <div class="container">

      <!-- Brand and toggle get grouped for better mobile display -->
      <a class="navbar-brand" href="/">Shawn</a>
      <button type="button" class="navbar-toggle btn" data-toggle="collapse" data-target="#navBar" aria-expanded="false">
        <i class="fa fa-bars"></i>
      </button>

      <div class="collapse navbar-collapse" id="navBar">
        <ul class="navbar-nav ml-auto">
          <li class="nav-item"><a class="nav-link" href="/theory">NN Theory</a></li>
          <li class="nav-item"><a class="nav-link" href="/engineering">Engineering</a></li>
          <li class="nav-item"><a class="nav-link" href="/talks">Talks</a></li>
          <li class="nav-item"><a class="nav-link" href="/misc">Misc Research</a></li>
          <!-- <li class="nav-item"><a class="nav-link" href="/philosophy">Philosophy</a></li> -->
          <li class="nav-item"><a class="nav-link" href="/blog">Notes</a></li>
        </ul>
      </div><!-- /.navbar-collapse -->

    </div>
  </nav>
</section>

    <section>
      <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <div class="jumbotron">
    <div class="container">
      <h1 class="page-title" itemprop="name headline">How to Convert Djvu File to PDF with Text Kept</h1>
      <p class="post-meta"><time datetime="2015-03-27T20:47:00+08:00" itemprop="datePublished">Mar 27, 2015</time></p>
    </div>

</div>


  <div class="content post-content container" itemprop="articleBody">
    <p>Finally, I have come up with a solution to convert Djvu format e-book to Pdf
format. This post is going to note down exactly HOW.</p>

<p>First, some background about why I am doing this.</p>

<p>In the ancient time, well-know scholars are proud of their collection of books
in their personal library, which is the physical incarnation of their knowledge
and journey of learning. Although still a majority of people prefers the old
way of reading paper books, the way to keep one’s collection of books is going
to change to the electronic format way eventually. There are three significant
benefits of doing this:</p>

<ol>
  <li>You are able to bring with you all your books anywhere without any extra
effort.</li>
  <li>E-books are searchable, which speed up your reading a lot.</li>
  <li>You can open multiple copies of your book at the same time so the cross
reference is much more easier than reading paper version.</li>
</ol>

<p>But one major drawback of the past years where I almost read e-books
exclusively is that at the time when I can only find djvu format of certain
files, I have no way to highlight text on the e-book, especially for Math
books, a lot of which are in djvu format.</p>

<p>After meeting with one file that I must take note, I decide to figure out a
solution. So here it is.</p>

<!-- more -->

<p>Basically, the mechanism works like this. We extract image and text from the
original djvu files separately. Then we create the wanted pdf with them.</p>

<p>The solution is a combination of several open source tools:</p>

<ol>
  <li><a href="http://jwilk.net/software/ocrodjvu">djvu2hocr</a>. It is a wrapper for OCR
systems, that allows you to perform OCR on DjVu files. Optical character
recognition (OCR) is the mechanical or electronic conversion of images of
typewritten or printed text into machine-encoded text.</li>
  <li><a href="http://djvu.sourceforge.net/">ddjvu</a>. We use it to decode image from djvu
file. It is part of the open source project DjVuLibre that offers program to
manipulate djvu files. But one of the most pity is that no program it offers
could add highlight and annotations to djvu in a GUI way. I think this is
one of the major reasons djvu cannot catch on besides some other big
reasons.</li>
  <li><a href="https://rubygems.org/gems/pdfbeads">pdfbeads</a>. PDFBeads is a small utility
written in Ruby which takes scanned page images and converts them into a
single PDF file.</li>
  <li><a href="http://www.ghostscript.com/">gs</a> PostScript and PDF language interpreter
and previewer. If you are using a modern UNIX environment, it is highly
possible you would have it installed by default. We need this when deal with
djvu books, since pdfbeads creates very large intermediate files which makes
converting large books infeasible. So we need to create pdf pages one by one
and use gs to merge them.</li>
</ol>

<h2 id="installation">INSTALLATION</h2>

<p>Only installation on Ubuntu is going to be described.</p>

<h3 id="ocrodjvu">ocrodjvu</h3>

<p><code class="highlighter-rouge">djvu2hocr</code> and <code class="highlighter-rouge">ddjvu</code> are from <code class="highlighter-rouge">ocrodjvu</code>.</p>

<p>ocrodjvu is in the official repository, so just type in:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>sudo apt-get install ocrodjvu
</code></pre>
</div>

<h3 id="pdfbeads">pdfbeads</h3>

<p><code class="highlighter-rouge">pdfbeads</code> is written in ruby. The package manager <code class="highlighter-rouge">gem</code> of ruby will handle
dependency in ruby but there are some addition library header needed to be
installed depending on your operating system. As for me, <code class="highlighter-rouge">libleptonica-dev</code> is
needed. Type in:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>sudo apt-get install libleptonica-dev
</code></pre>
</div>

<blockquote>
  <p><a href="http://www.leptonica.com/">Leptonica</a> is a pedagogically-oriented open
source site containing software that is broadly useful for image processing
and image analysis applications.</p>
</blockquote>

<p>If you have not done a lot image manipulation, it is highly probable that you
also need to install <code class="highlighter-rouge">libmagickwand-dev</code>:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>sudo apt-get install libmagickwand-dev
</code></pre>
</div>

<p>It mainly installs development package for ImageMagick. From its websites,
it is a:</p>

<blockquote>
  <p><a href="http://www.leptonica.com/">ImageMagick</a>® is a software suite to create,
edit, compose, or convert bitmap images. It can read and write images in a
variety of formats (over 200) including PNG, JPEG, JPEG-2000, GIF, TIFF, DPX,
EXR, WebP, Postscript, PDF, and SVG. Use ImageMagick to resize, flip, mirror,
rotate, distort, shear and transform images, adjust image colors, apply
various special effects, or draw text, lines, polygons, ellipses and Bézier
curves.</p>
</blockquote>

<p>And to ensure we are getting a reasonable size of pdf finally, we need to
use <a href="http://jbig2.com/">JBIG2</a> compression instead of TIFF G4 when creating
pdf. JBIG2 is an International Telecommunication Union format that represents a
revolutionary breakthrough in captured document technology. Using JBIG2
encoding, a scanned image can be compressed up to 10x smaller than with TIFF
G4.</p>

<p>This time we need to compile it from
<a href="https://github.com/agl/jbig2enc">source</a>. Standard pipe is good:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>./autogen.sh
./configure
make
make install <span class="o">(</span>or sudo make install<span class="o">)</span>
</code></pre>
</div>

<p>I have done a simple test on how much more compress JBIG2 could offer. Using
TIFF G4, one random chosen page of my djvu file will be 77K, while it is 21K
using JBIG2. Considering that the final output size of my pdf file is 49M, it
would beyond 100M if I used TIFF G4, which is too big for a pdf book.</p>

<p>With all prerequisite ready, we could install pdfbeads now:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>sudo gem install pdfbeads
</code></pre>
</div>

<h3 id="gs">gs</h3>

<p><code class="highlighter-rouge">gs</code> should be available already on Ubuntu.</p>

<h2 id="usage">Usage</h2>

<p>Basic usage for small file could be found on
<a href="http://askubuntu.com/questions/46233/converting-djvu-to-pdf">Converting DJVU to PDF</a>,
where I learned how to convert djvu file.</p>

<p>But if you want to convert something that is a book, converting it directly
using the method in the above link is going to crash your PC, at least freeze
it until you kill the process because pdfbeads is creating very huge
intermediate files. It exceeded 10G before I killed it in my case.</p>

<p>So to deal with the case, I write a script to process djvu file page by page
and merge all the pdf pages in the end. The script could be found on
<a href="https://github.com/shawnLeeZX/daily_tools/blob/master/djvu_2_pdf.sh">here</a>.</p>

<h2 id="ruby-header">ruby header</h2>

<p>You may also need to install <code class="highlighter-rouge">ruby-dev</code> to install the header file for ruby to
install gems.</p>

<h2 id="remark-on-other-solution">Remark on Other Solution</h2>

<p>Before I dived in all those complicated tools, I tried to some easier
solutions, including online converter and <code class="highlighter-rouge">gscan2pdf</code>. They both does not
work. <code class="highlighter-rouge">gscan2pdf</code> is capable of converting djvu to pdf with text. But it may
have trouble handling hundreds of pages ones given the error report I got.</p>

<hr />

<h2 id="update-on-ubuntu-1604">Update on Ubuntu 16.04</h2>

<p>Due to the fact that from ruby 2.3, <code class="highlighter-rouge">iconv</code> is not in the standard package, so
you need to install it manually.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>sudo gem install iconv
</code></pre>
</div>

  </div>

</article>

    </section>

    
    <div class="container">
      <section>
        <h1>Comments</h1>
        <div id="disqus_thread" aria-live="polite"><script type="text/javascript">
      var disqus_shortname = 'nautilus-shell-of-hhiker';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://shawnLeeZX.github.io/blog/2015/03/27/how-to-convert-djvu-file-to-pdf-with-text-kept/';
        var disqus_url = 'http://shawnLeeZX.github.io/blog/2015/03/27/how-to-convert-djvu-file-to-pdf-with-text-kept/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'https://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div>
      </section>
    </div>
    

    <nav class="navbar navbar-default navbar-fixed-bottom">
<div class="container footer-content">
    <!-- Nothing is there. -->
</div>
</nav>
  </body>

</html>
